{"version":3,"file":"manager.js","sources":["../../../src/core/class-based/manager.ts"],"sourcesContent":["// @ts-ignore\nimport { createCache, getValue } from '@glimmer/tracking/primitives/cache';\nimport { associateDestroyableChild } from '@ember/destroyable';\n// @ts-ignore\nimport { capabilities as helperCapabilities, setHelperManager } from '@ember/helper';\n\nimport { Resource } from './resource';\n\nimport type { ArgsWrapper } from '[core-types]';\nimport type Owner from '@ember/owner';\n\nclass ResourceManager {\n  capabilities = helperCapabilities('3.23', {\n    hasValue: true,\n    hasDestroyable: true,\n  });\n\n  constructor(protected owner: Owner) {}\n\n  createHelper(Class: typeof Resource, args: ArgsWrapper) {\n    let owner = this.owner;\n\n    let instance: Resource<ArgsWrapper>;\n\n    let cache: Cache = createCache(() => {\n      if (instance === undefined) {\n        instance = new Class(owner);\n\n        associateDestroyableChild(cache, instance);\n      }\n\n      if (instance.modify) {\n        instance.modify(args.positional, args.named);\n      }\n\n      return instance;\n    });\n\n    return cache;\n  }\n\n  getValue(cache: Cache) {\n    let instance = getValue(cache);\n\n    return instance;\n  }\n\n  getDestroyable(cache: Cache) {\n    return cache;\n  }\n}\n\nsetHelperManager((owner: Owner) => new ResourceManager(owner), Resource);\n"],"names":["ResourceManager","constructor","owner","_defineProperty","helperCapabilities","hasValue","hasDestroyable","createHelper","Class","args","instance","cache","createCache","undefined","associateDestroyableChild","modify","positional","named","getValue","getDestroyable","setHelperManager","Resource"],"mappings":";;;;;;AAWA,MAAMA,eAAe,CAAC;EAMpBC,WAAWA,CAAWC,KAAY,EAAE;AAAAC,IAAAA,eAAA,CALrBC,IAAAA,EAAAA,cAAAA,EAAAA,YAAkB,CAAC,MAAM,EAAE;AACxCC,MAAAA,QAAQ,EAAE,IAAI;AACdC,MAAAA,cAAc,EAAE,IAAA;AAClB,KAAC,CAAC,CAAA,CAAA;IAAA,IAEoBJ,CAAAA,KAAY,GAAZA,KAAY,CAAA;AAAG,GAAA;AAErCK,EAAAA,YAAYA,CAACC,KAAsB,EAAEC,IAAiB,EAAE;AACtD,IAAA,IAAIP,KAAK,GAAG,IAAI,CAACA,KAAK,CAAA;AAEtB,IAAA,IAAIQ,QAA+B,CAAA;AAEnC,IAAA,IAAIC,KAAY,GAAGC,WAAW,CAAC,MAAM;MACnC,IAAIF,QAAQ,KAAKG,SAAS,EAAE;AAC1BH,QAAAA,QAAQ,GAAG,IAAIF,KAAK,CAACN,KAAK,CAAC,CAAA;AAE3BY,QAAAA,yBAAyB,CAACH,KAAK,EAAED,QAAQ,CAAC,CAAA;AAC5C,OAAA;MAEA,IAAIA,QAAQ,CAACK,MAAM,EAAE;QACnBL,QAAQ,CAACK,MAAM,CAACN,IAAI,CAACO,UAAU,EAAEP,IAAI,CAACQ,KAAK,CAAC,CAAA;AAC9C,OAAA;AAEA,MAAA,OAAOP,QAAQ,CAAA;AACjB,KAAC,CAAC,CAAA;AAEF,IAAA,OAAOC,KAAK,CAAA;AACd,GAAA;EAEAO,QAAQA,CAACP,KAAY,EAAE;AACrB,IAAA,IAAID,QAAQ,GAAGQ,QAAQ,CAACP,KAAK,CAAC,CAAA;AAE9B,IAAA,OAAOD,QAAQ,CAAA;AACjB,GAAA;EAEAS,cAAcA,CAACR,KAAY,EAAE;AAC3B,IAAA,OAAOA,KAAK,CAAA;AACd,GAAA;AACF,CAAA;AAEAS,gBAAgB,CAAElB,KAAY,IAAK,IAAIF,eAAe,CAACE,KAAK,CAAC,EAAEmB,QAAQ,CAAC"}