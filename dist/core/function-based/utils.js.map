{"version":3,"file":"utils.js","sources":["../../../src/core/function-based/utils.ts"],"sourcesContent":["// @ts-ignore\nimport { getValue } from '@glimmer/tracking/primitives/cache';\n// @ts-ignore\nimport { invokeHelper } from '@ember/helper';\n\nimport { INTERMEDIATE_VALUE } from './types';\n\nimport type { InternalFunctionResourceConfig } from './types';\n\n/**\n * This is what allows resource to be used withotu @use.\n * The caveat though is that a property must be accessed\n * on the return object.\n *\n * A resource not using use *must* be an object.\n */\nexport function wrapForPlainUsage<Value>(\n  context: object,\n  setup: InternalFunctionResourceConfig<Value>,\n) {\n  let cache: Cache;\n\n  /*\n   * Having an object that we use invokeHelper + getValue on\n   * is how we convert the \"function\" in to a reactive utility\n   * (along with the following proxy for accessing anything on this 'value')\n   *\n   */\n  const target = {\n    get [INTERMEDIATE_VALUE]() {\n      if (!cache) {\n        cache = invokeHelper(context, setup);\n      }\n\n      return getValue<Value>(cache);\n    },\n  };\n\n  /**\n   * This proxy takes everything called on or accessed on \"target\"\n   * and forwards it along to target[INTERMEDIATE_VALUE] (where the actual resource instance is)\n   *\n   * It's important to only access .[INTERMEDIATE_VALUE] within these proxy-handler methods so that\n   * consumers \"reactively entangle with\" the Resource.\n   */\n  return new Proxy(target, {\n    get(target, key): unknown {\n      const state = target[INTERMEDIATE_VALUE];\n\n      return Reflect.get(state, key, state);\n    },\n\n    ownKeys(target): (string | symbol)[] {\n      const value = target[INTERMEDIATE_VALUE];\n\n      return Reflect.ownKeys(value);\n    },\n\n    getOwnPropertyDescriptor(target, key): PropertyDescriptor | undefined {\n      const value = target[INTERMEDIATE_VALUE];\n\n      return Reflect.getOwnPropertyDescriptor(value, key);\n    },\n  }) as never as Value;\n}\n"],"names":["wrapForPlainUsage","context","setup","cache","target","INTERMEDIATE_VALUE","invokeHelper","getValue","Proxy","get","key","state","Reflect","ownKeys","value","getOwnPropertyDescriptor"],"mappings":";;;;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASA,iBAAiBA,CAC/BC,OAAe,EACfC,KAA4C,EAC5C;AACA,EAAA,IAAIC,KAAY,CAAA;;AAEhB;AACF;AACA;AACA;AACA;AACA;AACE,EAAA,MAAMC,MAAM,GAAG;AACb,IAAA,KAAKC,kBAAkB,CAAI,GAAA;MACzB,IAAI,CAACF,KAAK,EAAE;AACVA,QAAAA,KAAK,GAAGG,YAAY,CAACL,OAAO,EAAEC,KAAK,CAAC,CAAA;AACtC,OAAA;MAEA,OAAOK,QAAQ,CAAQJ,KAAK,CAAC,CAAA;AAC/B,KAAA;GACD,CAAA;;AAED;AACF;AACA;AACA;AACA;AACA;AACA;AACE,EAAA,OAAO,IAAIK,KAAK,CAACJ,MAAM,EAAE;AACvBK,IAAAA,GAAGA,CAACL,MAAM,EAAEM,GAAG,EAAW;AACxB,MAAA,MAAMC,KAAK,GAAGP,MAAM,CAACC,kBAAkB,CAAC,CAAA;MAExC,OAAOO,OAAO,CAACH,GAAG,CAACE,KAAK,EAAED,GAAG,EAAEC,KAAK,CAAC,CAAA;KACtC;IAEDE,OAAOA,CAACT,MAAM,EAAuB;AACnC,MAAA,MAAMU,KAAK,GAAGV,MAAM,CAACC,kBAAkB,CAAC,CAAA;AAExC,MAAA,OAAOO,OAAO,CAACC,OAAO,CAACC,KAAK,CAAC,CAAA;KAC9B;AAEDC,IAAAA,wBAAwBA,CAACX,MAAM,EAAEM,GAAG,EAAkC;AACpE,MAAA,MAAMI,KAAK,GAAGV,MAAM,CAACC,kBAAkB,CAAC,CAAA;AAExC,MAAA,OAAOO,OAAO,CAACG,wBAAwB,CAACD,KAAK,EAAEJ,GAAG,CAAC,CAAA;AACrD,KAAA;AACF,GAAC,CAAC,CAAA;AACJ;;;;"}