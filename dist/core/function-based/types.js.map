{"version":3,"file":"types.js","sources":["../../../src/core/function-based/types.ts"],"sourcesContent":["import type Owner from '@ember/owner';\nimport type { Invoke } from '@glint/template/-private/integration';\n\nexport const INTERMEDIATE_VALUE = '__Intermediate_Value__';\nexport const INTERNAL = '__INTERNAL__';\n\nexport interface InternalFunctionResourceConfig<Value = unknown> {\n  definition: ResourceFunction<Value>;\n  type: 'function-based';\n  [INTERNAL]: true;\n}\n\nexport const CURRENT = Symbol('ember-resources::CURRENT');\n\nexport interface GlintRenderable {\n  /**\n   * Cells aren't inherently understood by Glint,\n   * so to work around that, we'll hook in to the fact that\n   * ContentValue (the type expected for all renderables),\n   * defines an interface with this signature.\n   *\n   * (SafeString)\n   *\n   * There *has* been interest in the community to formally support\n   * toString and toHTML APIs across all objects. An RFC needs to be\n   * written so that we can gather feedback / potential problems.\n   */\n  toHTML(): string;\n}\n\n// Will need to be a class for .current flattening / auto-rendering\nexport interface Reactive<Value> extends GlintRenderable {\n  current: Value;\n  [CURRENT]: Value;\n  [Invoke]?: Value;\n}\n\n/**\n * This is the type of the arguments passed to the `resource` function\n *\n * ```ts\n * import { resource, type ResourceAPI } from 'ember-resources';\n *\n * export const Clock = resource((api: ResourceAPI) => {\n *   let { on, use, owner } = api;\n *\n *   // ...\n * })\n * ```\n */\nexport type ResourceAPI = {\n  on: {\n    /**\n     * Optionally a function-resource can provide a cleanup function.\n     *\n     *\n     *  Example:\n     *  ```js\n     *  import { resource } from 'ember-resources';\n     *  import { TrackedObject } from 'tracked-built-ins';\n     *\n     *  const load = resource(({ on }) => {\n     *    let state = new TrackedObject({});\n     *    let controller = new AbortController();\n     *\n     *    on.cleanup(() => controller.abort());\n     *\n     *    fetch(this.url, { signal: controller.signal })\n     *      // ...\n     *\n     *    return state;\n     *  })\n     */\n    cleanup: (destroyer: Destructor) => void;\n  };\n\n  /**\n   * Allows for composition of resources.\n   *\n   * Example:\n   * ```js\n   * let formatter = new Intl.DateTimeFormat(\"en-US\", {\n   *   hour: \"numeric\",\n   *   minute: \"numeric\",\n   *   second: \"numeric\",\n   *   hour12: false,\n   * });\n   * let format = (time: Reactive<Date>) => formatter.format(time.current);\n   *\n   * const Now = resource(({ on }) => {\n   *    let now = cell(nowDate);\n   *    let timer = setInterval(() => now.set(Date.now()), 1000);\n   *\n   *    on.cleanup(() => clearInterval(timer));\n   *\n   *    return () => now.current;\n   *  });\n   *\n   *  const Stopwatch = resource(({ use }) => {\n   *    let time = use(Now);\n   *\n   *     return () => format(time);\n   *  });\n   * ```\n   */\n  use: <Value>(resource: Value) => Reactive<Value extends Reactive<any> ? Value['current'] : Value>;\n  /**\n   * The Application owner.\n   * This allows for direct access to traditional ember services.\n   *\n   * Example:\n   * ```js\n   * resource(({ owner }) => {\n   *   owner.lookup('service:router').currentRouteName\n   *  //...\n   * }\n   * ```\n   */\n  owner: Owner;\n};\n\n/**\n * Type of the callback passed to `resource`\n */\nexport type ResourceFunction<Value = unknown> = (hooks: ResourceAPI) => Value | (() => Value);\n\n/**\n * The perceived return value of `resource`\n * This is a lie to TypeScript, because the effective value of\n * of the resource is the result of the collapsed functions\n * passed to `resource`\n */\nexport type ResourceFn<Value = unknown> = (hooks: ResourceAPI) => Value;\n\nexport type Destructor = () => void;\nexport type Cache = object;\n"],"names":["INTERMEDIATE_VALUE","INTERNAL","CURRENT","Symbol"],"mappings":"AAGO,MAAMA,kBAAkB,GAAG,yBAAwB;AACnD,MAAMC,QAAQ,GAAG,eAAc;MAQzBC,OAAO,GAAGC,MAAM,CAAC,0BAA0B,EAAC;;AAkBzD;;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAwEA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;;;;"}